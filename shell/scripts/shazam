#!/usr/bin/env bash

IFS='' read -d '' icon <<- HERE
                      ......:::::::::::::----
                     .=====================-
                     =====================-
                    -====================-
                   :====================-
                  .====================-
                  ====================-
                 -===================-
                :===================-
               .------==============--------
                     -====================-
                    .====================-
                    ====================-
                   :===================:
                  .===================.
                  -==================.
                 :==================:....
                 ======================:
                 ....-===============:
                     ==============-.
                    .=============.
                    -===========:
                   .==========-
                   -========-.
                   ========:
                  :======-
                  -====-.
                 .====:
                 -==:
                 =-
                :.
HERE

printf "%s\n" "$icon"

read -p 'Shazam?! [y|n] ' confirmation

function link_targets {
    cd "${"$(dirname "$(readlink -f "$0")")"%shell}"

    targets=(git neovim nix shell)

    printf "%b %s\n" "\xe2\x9a\xa1" "Stowing targets."

    for target in ${targets[@]}
    do
        stow --verbose --target="$HOME" --stow "$target"
    done

    printf "%b %s\n" "\xe2\x9c\x85" "Targets stowed."
}

function install_nix {
    printf "%b %s\n" "\xe2\x9a\xa1" "Installing Nix package manager."
    
    os=$(uname -s)
    
    case "$os" in
        Darwin*)
            sh <(curl -L https://nixos.org/nix/install)
        ;;
        Linux*)
            sh <(curl -L https://nixos.org/nix/install) --daemon
        ;;

    printf "%b %s\n" "\xe2\x9c\x85" "Nix package manager installed."
}

case $confirmation in
    [Yy]*)
    # TODO: Execute setup.
    link_targets
    install_nix
    ;;
    [Nn]*)
    printf 'Goodbye!...\n'
    exit 0
    ;;
esac
